<!DOCTYPE html>
<html>

<body>
    <h2 id="status">登录成功,正在返回 App...</h2>
    <a href="javascript:void(0)" id="manualBtn"
        style="padding: 20px; display: none; background: #007bff; color: white; text-align: center;">
        手动点击返回
    </a>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const state = urlParams.get('state');

        if (code && state) {
            // 根据 state 动态拼接 Scheme
            const appSchemeUrl =
                state + "://callback?code=" + encodeURIComponent(code);

            console.log("正在通过自定义协议强力回跳:", appSchemeUrl);

            // 自动回跳
            window.location.replace(appSchemeUrl);

            // 保底：如果自动跳没触发，显示一个按钮
            setTimeout(() => {
                const btn = document.createElement('button');
                btn.innerText = "手动返回 App";
                btn.onclick = () => {
                    window.location.href = appSchemeUrl;
                };
                document.body.appendChild(btn);
            }, 500);

            // ===== 可选：Universal Link + fallback =====
            // const qs = window.location.search;
            // window.location.href = "https://<username>.github.io/oauth-debug/app/oauth" + qs;
            // setTimeout(() => {
            //     window.location.href = state + "://callback" + qs;
            // }, 800);

        } else {
            console.warn("缺少必要参数:", { code, state });
            document.getElementById("status").innerText =
                "登录失败：缺少 code 或 state";
        }
    </script>
</body>

</html>
